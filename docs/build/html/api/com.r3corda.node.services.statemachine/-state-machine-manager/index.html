<HTML>
<HEAD>
<title>StateMachineManager - </title>
<link rel="stylesheet" href="../../style.css">
</HEAD>
<BODY>
<a href="../index.html">com.r3corda.node.services.statemachine</a>&nbsp;/&nbsp;<a href=".">StateMachineManager</a><br/>
<br/>
<h1>StateMachineManager</h1>
<code><span class="keyword">class </span><span class="identifier">StateMachineManager</span></code><br/>
<p>A StateMachineManager is responsible for coordination and persistence of multiple <a href="#">ProtocolStateMachine</a> objects.
Each such object represents an instantiation of a (two-party) protocol that has reached a particular point.</p>
<p>An implementation of this class will persist state machines to long term storage so they can survive process restarts
and, if run with a single-threaded executor, will ensure no two state machines run concurrently with each other
(bad for performance, good for programmer mental health).</p>
<p>A "state machine" is a class with a single call method. The call method and any others it invokes are rewritten by
a bytecode rewriting engine called Quasar, to ensure the code can be suspended and resumed at any point.</p>
<p>The SMM will always invoke the protocol fibers on the given <a href="../../com.r3corda.node.utilities/-affinity-executor/index.html">AffinityExecutor</a>, regardless of which thread actually
starts them via <a href="add.html">add</a>.</p>
<p>TODO: Session IDs should be set up and propagated automatically, on demand.
TODO: Consider the issue of continuation identity more deeply: is it a safe assumption that a serialised
continuation is always unique?
TODO: Think about how to bring the system to a clean stop so it can be upgraded without any serialised stacks on disk
TODO: Timeouts
TODO: Surfacing of exceptions via an API and/or management UI
TODO: Ability to control checkpointing explicitly, for cases where you know replaying a message cant hurt
TODO: Implement stub/skel classes that provide a basic RPC framework on top of this.</p>
<br/>
<br/>
<br/>
<br/>
<h3>Types</h3>
<table>
<tbody>
<tr>
<td>
<a href="-fiber-request/index.html">FiberRequest</a></td>
<td>
<code><span class="keyword">class </span><span class="identifier">FiberRequest</span></code></td>
</tr>
<tr>
<td>
<a href="-fiber-scheduler/index.html">FiberScheduler</a></td>
<td>
<code><span class="keyword">inner</span> <span class="keyword">class </span><span class="identifier">FiberScheduler</span></code></td>
</tr>
</tbody>
</table>
<h3>Constructors</h3>
<table>
<tbody>
<tr>
<td>
<a href="-init-.html">&lt;init&gt;</a></td>
<td>
<code><span class="identifier">StateMachineManager</span><span class="symbol">(</span><span class="identifier" id="com.r3corda.node.services.statemachine.StateMachineManager$<init>(com.r3corda.node.services.api.ServiceHubInternal, kotlin.collections.List((kotlin.Any)), com.r3corda.node.services.api.CheckpointStorage, com.r3corda.node.utilities.AffinityExecutor)/serviceHub">serviceHub</span><span class="symbol">:</span>&nbsp;<a href="../../com.r3corda.node.services.api/-service-hub-internal/index.html"><span class="identifier">ServiceHubInternal</span></a><span class="symbol">, </span><span class="identifier" id="com.r3corda.node.services.statemachine.StateMachineManager$<init>(com.r3corda.node.services.api.ServiceHubInternal, kotlin.collections.List((kotlin.Any)), com.r3corda.node.services.api.CheckpointStorage, com.r3corda.node.utilities.AffinityExecutor)/tokenizableServices">tokenizableServices</span><span class="symbol">:</span>&nbsp;<span class="identifier">List</span><span class="symbol">&lt;</span><span class="identifier">Any</span><span class="symbol">&gt;</span><span class="symbol">, </span><span class="identifier" id="com.r3corda.node.services.statemachine.StateMachineManager$<init>(com.r3corda.node.services.api.ServiceHubInternal, kotlin.collections.List((kotlin.Any)), com.r3corda.node.services.api.CheckpointStorage, com.r3corda.node.utilities.AffinityExecutor)/checkpointStorage">checkpointStorage</span><span class="symbol">:</span>&nbsp;<a href="../../com.r3corda.node.services.api/-checkpoint-storage/index.html"><span class="identifier">CheckpointStorage</span></a><span class="symbol">, </span><span class="identifier" id="com.r3corda.node.services.statemachine.StateMachineManager$<init>(com.r3corda.node.services.api.ServiceHubInternal, kotlin.collections.List((kotlin.Any)), com.r3corda.node.services.api.CheckpointStorage, com.r3corda.node.utilities.AffinityExecutor)/executor">executor</span><span class="symbol">:</span>&nbsp;<a href="../../com.r3corda.node.utilities/-affinity-executor/index.html"><span class="identifier">AffinityExecutor</span></a><span class="symbol">)</span></code><p>A StateMachineManager is responsible for coordination and persistence of multiple <a href="#">ProtocolStateMachine</a> objects.
Each such object represents an instantiation of a (two-party) protocol that has reached a particular point.</p>
</td>
</tr>
</tbody>
</table>
<h3>Properties</h3>
<table>
<tbody>
<tr>
<td>
<a href="all-state-machines.html">allStateMachines</a></td>
<td>
<code><span class="keyword">val </span><span class="identifier">allStateMachines</span><span class="symbol">: </span><span class="identifier">List</span><span class="symbol">&lt;</span><a href="../../com.r3corda.core.protocols/-protocol-logic/index.html"><span class="identifier">ProtocolLogic</span></a><span class="symbol">&lt;</span><span class="identifier">*</span><span class="symbol">&gt;</span><span class="symbol">&gt;</span></code></td>
</tr>
<tr>
<td>
<a href="changes.html">changes</a></td>
<td>
<code><span class="keyword">val </span><span class="identifier">changes</span><span class="symbol">: </span><span class="identifier">&lt;ERROR CLASS&gt;</span><span class="symbol">&lt;</span><span class="identifier">&lt;ERROR CLASS&gt;</span><span class="symbol">&lt;</span><a href="../../com.r3corda.core.protocols/-protocol-logic/index.html"><span class="identifier">ProtocolLogic</span></a><span class="symbol">&lt;</span><span class="identifier">*</span><span class="symbol">&gt;</span><span class="symbol">,</span>&nbsp;<a href="../../com.r3corda.node.utilities/-add-or-remove/index.html"><span class="identifier">AddOrRemove</span></a><span class="symbol">&gt;</span><span class="symbol">&gt;</span></code></td>
</tr>
<tr>
<td>
<a href="checkpoint-storage.html">checkpointStorage</a></td>
<td>
<code><span class="keyword">val </span><span class="identifier">checkpointStorage</span><span class="symbol">: </span><a href="../../com.r3corda.node.services.api/-checkpoint-storage/index.html"><span class="identifier">CheckpointStorage</span></a></code></td>
</tr>
<tr>
<td>
<a href="executor.html">executor</a></td>
<td>
<code><span class="keyword">val </span><span class="identifier">executor</span><span class="symbol">: </span><a href="../../com.r3corda.node.utilities/-affinity-executor/index.html"><span class="identifier">AffinityExecutor</span></a></code></td>
</tr>
<tr>
<td>
<a href="scheduler.html">scheduler</a></td>
<td>
<code><span class="keyword">val </span><span class="identifier">scheduler</span><span class="symbol">: </span><a href="-fiber-scheduler/index.html"><span class="identifier">FiberScheduler</span></a></code></td>
</tr>
<tr>
<td>
<a href="service-hub.html">serviceHub</a></td>
<td>
<code><span class="keyword">val </span><span class="identifier">serviceHub</span><span class="symbol">: </span><a href="../../com.r3corda.node.services.api/-service-hub-internal/index.html"><span class="identifier">ServiceHubInternal</span></a></code></td>
</tr>
</tbody>
</table>
<h3>Functions</h3>
<table>
<tbody>
<tr>
<td>
<a href="add.html">add</a></td>
<td>
<code><span class="keyword">fun </span><span class="symbol">&lt;</span><span class="identifier">T</span><span class="symbol">&gt;</span> <span class="identifier">add</span><span class="symbol">(</span><span class="identifier" id="com.r3corda.node.services.statemachine.StateMachineManager$add(kotlin.String, com.r3corda.core.protocols.ProtocolLogic((com.r3corda.node.services.statemachine.StateMachineManager.add.T)))/loggerName">loggerName</span><span class="symbol">:</span>&nbsp;<span class="identifier">String</span><span class="symbol">, </span><span class="identifier" id="com.r3corda.node.services.statemachine.StateMachineManager$add(kotlin.String, com.r3corda.core.protocols.ProtocolLogic((com.r3corda.node.services.statemachine.StateMachineManager.add.T)))/logic">logic</span><span class="symbol">:</span>&nbsp;<a href="../../com.r3corda.core.protocols/-protocol-logic/index.html"><span class="identifier">ProtocolLogic</span></a><span class="symbol">&lt;</span><span class="identifier">T</span><span class="symbol">&gt;</span><span class="symbol">)</span><span class="symbol">: </span><span class="identifier">&lt;ERROR CLASS&gt;</span><span class="symbol">&lt;</span><span class="identifier">T</span><span class="symbol">&gt;</span></code><p>Kicks off a brand new state machine of the given class. It will log with the named logger.
The state machine will be persisted when it suspends, with automated restart if the StateMachineManager is
restarted with checkpointed state machines in the storage service.</p>
</td>
</tr>
<tr>
<td>
<a href="find-state-machines.html">findStateMachines</a></td>
<td>
<code><span class="keyword">fun </span><span class="symbol">&lt;</span><span class="identifier">P</span>&nbsp;<span class="symbol">:</span>&nbsp;<a href="../../com.r3corda.core.protocols/-protocol-logic/index.html"><span class="identifier">ProtocolLogic</span></a><span class="symbol">&lt;</span><span class="identifier">T</span><span class="symbol">&gt;</span><span class="symbol">, </span><span class="identifier">T</span><span class="symbol">&gt;</span> <span class="identifier">findStateMachines</span><span class="symbol">(</span><span class="identifier" id="com.r3corda.node.services.statemachine.StateMachineManager$findStateMachines(java.lang.Class((com.r3corda.node.services.statemachine.StateMachineManager.findStateMachines.P)))/protocolClass">protocolClass</span><span class="symbol">:</span>&nbsp;<a href="http://docs.oracle.com/javase/6/docs/api/java/lang/Class.html"><span class="identifier">Class</span></a><span class="symbol">&lt;</span><span class="identifier">P</span><span class="symbol">&gt;</span><span class="symbol">)</span><span class="symbol">: </span><span class="identifier">List</span><span class="symbol">&lt;</span><span class="identifier">&lt;ERROR CLASS&gt;</span><span class="symbol">&lt;</span><span class="identifier">P</span><span class="symbol">,</span>&nbsp;<span class="identifier">&lt;ERROR CLASS&gt;</span><span class="symbol">&lt;</span><span class="identifier">T</span><span class="symbol">&gt;</span><span class="symbol">&gt;</span><span class="symbol">&gt;</span></code><p>Returns a list of all state machines executing the given protocol logic at the top level (subprotocols do not count)</p>
</td>
</tr>
<tr>
<td>
<a href="start.html">start</a></td>
<td>
<code><span class="keyword">fun </span><span class="identifier">start</span><span class="symbol">(</span><span class="symbol">)</span><span class="symbol">: </span><span class="identifier">Unit</span></code></td>
</tr>
</tbody>
</table>
</BODY>
</HTML>
